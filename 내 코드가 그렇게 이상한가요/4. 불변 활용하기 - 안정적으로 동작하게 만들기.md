
## 재할당

변수에 값을 다시 할당하는 것을 재할당 또는 파괴적 할당이라고 합니다. 재할당은 변수의 의미를 바꿔 추측하기 어렵게 만듭니다.

#### 1) 불변 변수로 만들어서 재할당 막기

재할당을 기계적으로 막을 수 있는 방법이 있습니다. 변수에 final 수식자를 붙이면 됩니다.

#### 2) 매개변수도 불변으로 만들기

매개변수도 마찬가지 입니다. 매개변수를 변경하면 값의 의미가 바뀔 수 있습니다. 재할당을 막으려면, 매개변수에도 final을 붙이면 됩니다.


---

## 가변으로 인해 발생하는 의도하지 않은 영향

인스턴스가 가변이면 다른 부분에 의도하지 않은 영향을 주기 쉽습니다. 코드를 변경했을 때, 생각하지도 못했던 위치에서 상태가 변화하여 예측하지 못한 동작을 하는 경우가 있습니다.

의도하지 않게 영향을 끼치는 2가지 살계가 있습니다.

- 가변 인스턴스 재사용하기
- 함수로 가변 인스턴스 조작하기

<span style="color:#ff0000">함수의 부수 효과는 '함수가 매개변수를 전달받고, 값을 리턴하는 것' 이외에 외부 상태(인스턴스 변수 등)를 변경하는 것을 가리킵니다.</span>

조금 더 구체적으로 설명하면, 함수에는 주요 작용과 부수 효과가 있습니다.

- 주요 작용 : 함수(메서드)가 매개변수를 전달받고, 값을 리턴하는 것
- 부수 효과 : 주요 작용 이외의 상태 변경을 일으키는 것

부수 효과가 있는 함수는 영향 범위를 예측하기 힘듭니다. 따라서 예상치 못한 동작을 막으려면, 함수가 영향을 주거나 받을 수 있는 범위를 한정하는 것이 좋습니다. 함수는 다음 항목을 만족하도록 설계하는 것이 좋습니다.

- 데이터(상태)는 매개변수로 받습니다.
- 상태를 변경하지 않습니다.
- 값은 함수의 리턴 값으로 돌려줍니다.

> 따라서 매개변수로 상태를 받고, 상태를 변경하지 않고, 값을 리턴하기만 하는 함수가 이상적입니다.

> 추가로 객체 지향 프로그래밍 언어는 함수의 부수 효과로 인한 범위를 클래스 내부까지 허용하는 것이 일반적입니다.

이러한 부수 효과의 여지 자체를 없앨 수 있게, 인스턴스 변수 value에 final 수식자를 붙여서 불변으로 만들면 좋습니다. 그리고 반환값으로 새로운 객체를 생성하여 반환하는 것이 좋습니다. 아래 예시를 통해 확인해봅니다.

```java
public Weapon reinforce(final AttackPower increment) {
	final AttackPoser reinforced = attackPower.reinforce(increment);
	return new Weapon(reinforced);
}
```


---

## 불변과 가변은 어떻게 다루어야 할까

#### 1) 기본적으로 불변으로

지금까지 설명한 것처럼 변수를 불변으로 만들면 다음과 같은 장점이 있습니다.

- 변수의 의미가 변하지 않으므로, 혼란을 줄일 수 있음
- 동작이 안정적이게 되므로, 결과를 예측하기 쉬움
- 코드의 영향 범위가 한정적이므로, 유지 보수가 편리해짐

> 따라서 기본적으로 불변으로 설계하는 것이 좋습니다.

#### 2) 가변으로 설계해야 하는 경우

기본적으로 불변으로 설계하는 것이 좋지만, 가변이 필요한 경우도 있습니다. 바로 성능이 중요한 경우입니다. 예를 들어 대량의 데이터를 빠르게 처리해야하는 경우, 이미지를 처리하는 경우, 리소스에 제약이 큰 임베디드 소프트웨어를 다루는 경우는 가변을 사용하는 것이 좋을 수 있습니다.

#### 3) 상태를 변경하는 메서드 설계하기

인스턴스 변수를 가변으로 만들었다면, 메서드를 만들 때 주의해야 할 점이 있습니다.
예를 들어 Hipoint 의 상태를 변경시킬 때 0 이상이어야 하는 조건이 있다면 반드시 조건을 잘 확인하고 만들어야 합니다.

> 상태를 변화시키는 메서드를 뮤테이터라고 합니다.

#### 4) 코드 외부와 데이터 교환은 국소화하기

불변을 활용해서 아무리 신중하게 설계하더라도, 코드 외부와의 데이터 교환은 주의해야 합니다. 파일을 읽고 쓰는 I/O 조작은 코드 외부의 상태에 의존합니다. 웹 애플리케이션도 거의 필수로 데이터베이스를 사용합니다.

최근에는 이러한 영향을 그나마 줄일 수 있게, 코드 외부와 데이터 교환을 국소화하는 테크닉을 많이 사용합니다. 국소화하는 방법으로는 예를 들어 리포지터리 패턴이 있습니다. 리포지터리 패턴은 데이터베이스의 영속화를 캡슐화하는 디자인 패턴입니다.
